<%@page import="java.util.Date"%>
<%@page import="java.text.SimpleDateFormat"%>
<%@ page language="java" contentType="text/html; charset=UTF-8"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"%>
<%@ taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt"%>
<%@ taglib prefix="fn" uri="http://java.sun.com/jsp/jstl/functions"%>
<%@ taglib prefix="sec"
	uri="http://www.springframework.org/security/tags"%>
<script src="/resources/js/jspdf.min.js"></script>
<script src="/resources/js/bluebird.min.js"></script>
<script src="/resources/jshtml2canvas.min.js"></script>
<style type="text/css">

.certiDiv {
	background-color: white;
	position:absolute;
	top:0%;
	height: 23cm;
	width: 21cm;
	z-index: 1;
	font-weight : bold;
	
}

.title{ 
    font-size: 2em;
    text-align: center; 
    position: absolute;
    top: 5%; 
    left: 50%; 
    transform: translate(-50%, -50%);
     
}
.tr1, .tr2, .tr3, .tr4, .tr5, .tr6 , .tr7{
    font-size: 1.5em;
    position: absolute;
}
.tr1 { 
	top: 25%; 
    left: 15%; 
} 

.tr2 {
    top: 30%; 
    left: 15%; 
} 

.tr3 {
    top: 35%; 
    left: 15%; 
} 

.tr4 {
    top: 40%; 
    left: 15%; 
}

.tr5 {
    top: 45%; 
    left: 15%; 
}
.tr6 {
    top: 65%; 
    left: 50%; 
    transform: translate(-50%, -50%);
} 
.tr7 {
    top: 73%; 
    left: 50%; 
    transform: translate(-50%, -50%);
} 
.tr8 {
	position: absolute;
	font-size: 2.0em;
    top: 85%; 
    left: 50%; 
    transform: translate(-50%, -50%);
    z-index: 1;
} 
#logo {
    opacity: 0.4;
    position: absolute;
    top: 30%; 
    left: 50%;
    transform: translate(-50%);
    z-index: -1;
}
#stemp{
    opacity: 1;
    width: 100px;
    height: 100px;
    position: absolute;
    top: 79.5%; 
    left: 70.5%;
    transform: translate(-50%);
    z-index: -1;
}

</style>
<%
    SimpleDateFormat dateFormat = new SimpleDateFormat("yyyy년 MM월 dd일");
    String formattedDate = dateFormat.format(new Date());
%>
<button type="button" onclick="pdfPrint()">Generate PDF@@</button>
<div class="certiDiv">
	<table class="tbl">
		<tr class="title">
			<td>졸&nbsp;&nbsp;업&nbsp;&nbsp;증&nbsp;&nbsp;명&nbsp;&nbsp;서</td>
		</tr>
		<tr class="tr1">
			<td>성&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;명&nbsp;:&nbsp;${stuPrivacyInfoVO.userVO.userNm}</td>
		</tr>
		<tr class="tr2">
			<td>생&nbsp;년&nbsp;월&nbsp;일&nbsp;:&nbsp;${stuPrivacyInfoVO.userVO.userReg1}</td>
		</tr>
		<tr class="tr3">
			<td>학&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;번&nbsp;:&nbsp;${stuPrivacyInfoVO.userVO.userCd}</td>
		</tr>
		<tr class="tr4">
			<td>계&nbsp;열/전&nbsp;공&nbsp;:&nbsp;${stuPrivacyInfoVO.departmentVO.colNm}/${stuPrivacyInfoVO.departmentVO.depNm}</td>
		</tr>
		<tr class="tr5">
			<td>졸&nbsp;업&nbsp;일&nbsp;자&nbsp;:&nbsp;<fmt:formatDate value="${stuPrivacyInfoVO.stuGrdt}" pattern="YY-MM-DD"/></td>
		</tr>
		<tr class="tr6">
			<td>위의&nbsp;&nbsp;사실을&nbsp;&nbsp;증명합니다.</td>
		</tr>
		<tr class="tr7">
			<td><%= formattedDate %></td>
		</tr>
		<tr class="tr8">
			<td>형&nbsp;&nbsp;택&nbsp;&nbsp;대&nbsp;&nbsp;학&nbsp;&nbsp;교&nbsp;&nbsp;총&nbsp;&nbsp;장</td>
		</tr>
	
	</table>
	<img id="logo" alt="" src="/resources/images/logo_circle.png">
	<img id="stemp" alt="" src="/resources/images/stemp.jpg">
</div>

<%-- ${stuPrivacyInfoVO} --%>
<script type="text/javascript">
<!-- // logout = function() { -->
<!-- // 	$("#logoutForm").submit(); -->
<!-- // } -->
	
    function pdfPrint(){
		
    	var element = document.querySelector('.certiDiv');
    	
        // 현재 document.body의 html을 A4 크기에 맞춰 PDF로 변환
        html2canvas(element, {
            onrendered: function (canvas) {
				var imgData = canvas.toDataURL('image/png');

                var imgWidth = 210; // 이미지 가로 길이(mm) A4 기준
                var pageHeight = imgWidth * 1.414;  // 출력 페이지 세로 길이 계산 A4 기준
                var imgHeight = canvas.height * imgWidth / canvas.width;
                var heightLeft = imgHeight;

                var doc = new jsPDF('p', 'mm');
                var position = 10;
                doc.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                heightLeft -= pageHeight;

                // 한 페이지 이상일 경우 루프 돌면서 출력
                while (heightLeft >= 20) {
                    position = heightLeft - imgHeight;
                    doc.addPage();
                    doc.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                    heightLeft -= pageHeight;
                }
                // 파일 저장
                doc.save('${stuPrivacyInfoVO.userVO.userNm} 졸업증명서.pdf');


                //이미지로 표현
                //document.write('<img src="'+imgData+'" />');
            }
            
        });
        
    }
    window.onload = function(){
        pdfPrint();
    }

</script>




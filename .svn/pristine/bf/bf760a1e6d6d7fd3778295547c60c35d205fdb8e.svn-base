<%@ page language="java" contentType="text/html; charset=UTF-8"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<%@ taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt"%>
<%@ taglib prefix="fn" uri="http://java.sun.com/jsp/jstl/functions"%>
<%@ taglib prefix="sec" uri="http://www.springframework.org/security/tags" %>
<script src="/resources/js/jquery.min.js"></script>
<style>
 	.dataTables_paginate paging_simple_numbers{margin: 0 auto;}
 	.col-sm-12 col-md-7{margin: 0 auto;}
 	
 	.mail_toolbar {
	margin-left: 25px;
	padding: 10px;
	webkit-box-flex: 0;
	-webkit-flex: 0 0 auto;
	flex: 0 0 auto;
	position: relative;
	top: auto;
	right: auto;
	left: auto;
	margin: 0 25px;
	-webkit-box-flex: 0;
	flex: 0 0 auto;
	position: relative;
	top: auto;
	right: auto;
	left: auto;
	-webkit-box-align: center;
	align-items: center;
	border-top: 1px solid #ddd;
	justify-content: space-between;
}

.mail_toolbar.type_write {
	display: flex;
	flex-wrap: wrap;
	height: 50px;
	margin: 0px;
}
.mail_toolbar_task {
	display: flex;
}
.mail_btn {
	margin: 0 5px 0 9px;
	padding: 3px 10px;
	outline: none;
	line-height: 20px;
	background-color: transparent;
 	cursor: pointer;
	touch-action: manipulation;
	border: 0;
}
.button_group_mail {
	display: flex;
    padding-left: 25px;
    justify-content: space-evenly;
}
</style>
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
   
    <link rel="stylesheet" href="/resources/test/fonts/icomoon/style.css">
   
    <!-- Style -->
    <link rel="stylesheet" href="/resources/test/css/style.css">
</head>
<body>
<sec:authentication property="principal.userVO" var="userVO"/>
<div class="divMailbox">
	<div class="mailHeader">
		<div class="mailHeaderName">
			보낸 메일함
		</div>
		<div class="mailSearchForm">
			<form>
				<input class="mailSearch" type="text" placeholder="메일 검색" name="keyword"
					value="${keyword}" />
				<input type="image" src="/resources/images/free-icon-search-149852.png" name="submit" class="mailSearchBtn" value="검색" />
			</form>
		</div>
	</div>
	<div class="containerMail">
<!-- ----------------------------------------------------------------------------- -->
	<div class="mail_toolbar type_write">
		<div class="mail_toolbar_task">
			<label class="control control--checkbox">
				<input type="checkbox" class="js-check-all" name="mailCheck"/>
				<div class="control__indicator"></div>
	        </label>
			<div class="button_group_mail">
				<div class="button_task_wrap">
					<button id="btnDelete" class="mail_btn" type="button">
						<span class="text" style="font-weight: bold; font-size: 14px;">삭제</span>
					</button>
				</div>
			</div>
		</div>
	</div>
<!-- ----------------------------------------------------------------------------- -->	
		<table class="table custom-table">
<!-- 		  <thead> -->
<!-- 		    <tr> -->
<!-- 		      <th scope="col"> -->
<!-- 		        <label class="control control--checkbox"> -->
<!-- 		          <input type="checkbox" class="js-check-all" name="mailCheck"/> -->
<!-- 		          <div class="control__indicator"></div> -->
<!-- 		        </label> -->
<!-- 		      </th> -->
<!-- 		      <th onclick="deleteCheck()">삭제</th> -->
<!-- 		    </tr> -->
<!-- 		  </thead> -->
		  <tbody>
		  	<c:forEach var="univMailVO" items="${data}">
		     <tr>
		       <th scope="row">
		         <label class="control control--checkbox">
		           <input type="checkbox" name="mailCheck"  data-uml-cd="${univMailVO.umlCd}"/>
		           <div class="control__indicator"></div>
		         </label>
		       </th>
		       <td style="width: 50px;">
		       <c:if test="${univMailVO.umlYn eq 0}">
		       	<svg xmlns="http://www.w3.org/2000/svg" height="17" width="17" viewBox="0 0 512 512"><!--!Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2023 Fonticons, Inc.--><path fill="#707070" d="M48 64C21.5 64 0 85.5 0 112c0 15.1 7.1 29.3 19.2 38.4L236.8 313.6c11.4 8.5 27 8.5 38.4 0L492.8 150.4c12.1-9.1 19.2-23.3 19.2-38.4c0-26.5-21.5-48-48-48H48zM0 176V384c0 35.3 28.7 64 64 64H448c35.3 0 64-28.7 64-64V176L294.4 339.2c-22.8 17.1-54 17.1-76.8 0L0 176z"/></svg>
<!-- 		         <img alt="" class="mailRead" src="/resources/images/mail3.png" style="width: 30px; height: 30px; opacity: 70%;" /> -->
		       </c:if>
		       <c:if test="${univMailVO.umlYn eq 1}">
		       	<svg xmlns="http://www.w3.org/2000/svg" height="17" width="17" viewBox="0 0 512 512"><!--!Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2023 Fonticons, Inc.--><path fill="#707070" d="M64 208.1L256 65.9 448 208.1v47.4L289.5 373c-9.7 7.2-21.4 11-33.5 11s-23.8-3.9-33.5-11L64 255.5V208.1zM256 0c-12.1 0-23.8 3.9-33.5 11L25.9 156.7C9.6 168.8 0 187.8 0 208.1V448c0 35.3 28.7 64 64 64H448c35.3 0 64-28.7 64-64V208.1c0-20.3-9.6-39.4-25.9-51.4L289.5 11C279.8 3.9 268.1 0 256 0z"/></svg>
<!-- 		         <img alt="" class="mailRead" src="/resources/images/openmail.png" style="width: 30px; height: 30px; opacity: 70%;" /> -->
		       </c:if>
		       </td>
		       <td style="width: 15%;">
		         ${univMailVO.userVO.userNm}
		       </td>
		       <td style="width: 60%;">
		         <a class="mailTitle" href="/mail/sendDetail?umlCd=${univMailVO.umlCd}" style="color: #333333">${univMailVO.umlTitle}</a>
		       </td>
		       <td style="text-align: right;"><fmt:formatDate pattern="MM월 dd일 HH:mm" value="${univMailVO.umlReg}"/> </td>
		       <td style="text-align: right; width: 10px;"><img src="/resources/images/x.png" style="width: 10px; height: 10px;" class="deleteMail" data-uml-cd="${univMailVO.umlCd}" /></td>
		     </tr>
		    </c:forEach>
		  </tbody>
		</table>
	    ${articlePage.getPagingArea()}
	</div>
</div>
    
<script src="/resources/test/js/jquery-3.3.1.min.js"></script>
<script src="/resources/test/js/popper.min.js"></script>
<script src="/resources/test/js/bootstrap.min.js"></script>
<script src="/resources/test/js/main.js"></script>
</body>
<script type="text/javascript">
$(function(){
	
	$("#btnDelete").on("click", function(){
		let deleteArr = [];

		$('input:checkbox[name=mailCheck]').each(function(index) {
			if ($(this).is(":checked") == true) {
				deleteArr.push($(this).data("umlCd"));
			}
		});

		if(confirm("삭제하시겠습니까?")){
			
			$.ajax({
				url : "/mail/deleteCheck",
				contentType : "application/json; charset=utf-8",
				data : JSON.stringify(deleteArr),
				type : "post",
				beforeSend : function(xhr) {
					xhr.setRequestHeader("${_csrf.headerName}",
							"${_csrf.token}");
				},
				success : function(res) {
					console.log("삭제!");
					location.reload();
				}
			});
		}
	});
	
	$(".deleteMail").on("click", function(){
		if(confirm("삭제하시겠습니까?")){
			
			let umlCd = $(this).data("umlCd");
			console.log("umlCd : " + umlCd);
			
			$.ajax({
				url:"/mail/deleteSentMail?umlCd="+umlCd,
				data:umlCd,
				type:"post",
				beforeSend:function(xhr){
					xhr.setRequestHeader("${_csrf.headerName}","${_csrf.token}");
				},
				success:function(res){
					alert("삭제 완료");
					location.reload();
				}
			});
		}
	});
});
</script>
</html>











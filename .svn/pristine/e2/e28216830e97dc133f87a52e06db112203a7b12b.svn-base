<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.or.ddit.mapper.NoticeBoardMapper">
	
	<resultMap type="noticeBoardVO" id="noticeBoardMap">
		<result property="nbCd" column="NB_CD"/>
		<result property="empCd" column="EMP_CD"/>
		<result property="userNm" column="USER_NM"/>
		<result property="fileCd" column="FILE_CD"/>
		<result property="nbTitle" column="NB_TITLE"/>
		<result property="nbCon" column="NB_CON"/>
		<result property="nbReg" column="NB_REG"/>
		<result property="nbUdt" column="NB_UDT"/>
		<result property="nbCnt" column="NB_CNT"/>
		<association property="employeeVO" resultMap="employeeMap"></association>
		<collection property="filesDetailVOList" resultMap="filesDetailMap"></collection>
	</resultMap>
	
	<resultMap type="filesDetailVO" id="filesDetailMap">
		<result property="fileSn" column="FILE_SN"/>
		<result property="fileCd" column="FILE_CD"/>
		<result property="filePath" column="FILE_PATH"/>
		<result property="fileOrnm" column="FILE_ORNM"/>
		<result property="fileSvnm" column="FILE_SVNM"/>
		<result property="fileExtsn" column="FILE_EXTSN"/>
		<result property="fileCon" column="FILE_CON"/>
		<result property="fileSize" column="FILE_SIZE"/>
	</resultMap>
	
	<resultMap type="employeeVO" id="employeeMap">
		<result property="empCd" column="EMP_CD"/>
		<result property="empDept" column="EMP_DEPT"/>
		<result property="empPos" column="EMP_POS"/>
		<result property="empJoin" column="EMP_JOIN"/>
		<result property="empQuit" column="EMP_QUIT"/>	
	</resultMap>
	
	<resultMap type="userVO" id="UsersMap">
		<result property="userCd" column="USER_CD"/>
		<result property="fileCd" column="FILE_CD"/>
		<result property="userNm" column="USER_NM"/>
		<result property="userNme" column="USER_NME"/>
		<result property="userTel" column="USER_TEL"/>
		<result property="userZip" column="USER_ZIP"/>
		<result property="userAddr1" column="USER_ADDR1"/>
		<result property="userAddr2" column="USER_ADDR2"/>
		<result property="userReg1" column="USER_REG1"/>
		<result property="userReg2" column="USER_REG2"/>
		<result property="userMail" column="USER_MAIL"/>
		<result property="userPass" column="USER_PASS"/>
		<result property="userBank" column="USER_BANK"/>
		<result property="userDepo" column="USER_DEPO"/>
		<result property="userAcc" column="USER_ACC"/>
		<result property="comdCd" column="COMD_CD"/>
	</resultMap>
	
	<select id="list" resultMap="noticeBoardMap">
		SELECT A.NB_CD, A.EMP_CD, (SELECT C.USER_NM FROM USERS C WHERE C.USER_CD = A.EMP_CD) USER_NM, A.FILE_CD, A.NB_TITLE, A. NB_CON, A.NB_REG, A.NB_UDT, A.NB_CNT, B.EMP_CD,
		FILE_SN, FILE_PATH, FILE_ORNM, FILE_SVNM, FILE_EXTSN, FILE_CON, FILE_SIZE
		FROM NOTICE_BOARD A, EMPLOYEE B, FILES_DETAIL F
		WHERE A.EMP_CD=B.EMP_CD
		AND 	A.FILE_CD = F.FILE_CD
	</select>
	
	<select id="detail" resultMap="noticeBoardMap" parameterType="String">
		SELECT  A.NB_CD, A.EMP_CD, (SELECT C.USER_NM FROM USERS C WHERE C.USER_CD = A.EMP_CD) USER_NM, A.FILE_CD, A.NB_TITLE, A. NB_CON, A.NB_REG, A.NB_UDT, A.NB_CNT, B.EMP_CD,
		FILE_SN, FILE_PATH, FILE_ORNM, FILE_SVNM, FILE_EXTSN, FILE_CON, FILE_SIZE
		FROM NOTICE_BOARD A, EMPLOYEE B, FILES_DETAIL F
		WHERE 	A.EMP_CD=B.EMP_CD
		AND 	A.FILE_CD = F.FILE_CD
		AND		A.NB_CD = #{nbCd}
	</select>
	
	<update id="count" parameterType="noticeBoardVO">
		<selectKey resultType="int" keyProperty="nbCnt" order="BEFORE">
			SELECT NB_CNT FROM NOTICE_BOARD
			WHERE NB_CD = #{nbCd}
		</selectKey>
		UPDATE NOTICE_BOARD
		SET NB_CNT = (#{nbCnt} + 1)
		WHERE NB_CD = #{nbCd}
	</update>
	<update id="updatePost" parameterType="noticeBoardVO">
		UPDATE NOTICE_BOARD
		SET NB_TITLE= #{nbTitle} , NB_CON= #{nbCon}, NB_UDT=SYSDATE
		WHERE NB_CD = #{nbCd}
	</update>
	
	<delete id="deletePost">
		DELETE FROM NOTICE_BOARD
		WHERE NB_CD = #{nbCd}
	</delete>
	
</mapper>













































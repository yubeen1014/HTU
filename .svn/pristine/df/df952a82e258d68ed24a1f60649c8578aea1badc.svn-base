<%@ page language="java" contentType="text/html; charset=UTF-8"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"%>
<%@ taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt"%>
<%@ taglib prefix="fn" uri="http://java.sun.com/jsp/jstl/functions"%>
<%@ taglib prefix="sec"
	uri="http://www.springframework.org/security/tags"%>

<style>
#datatable-scroller {
	width: 1000px;
}
.container{
	width: 1032px;
}

.image_container {
	width: 500px;
	height: 200px;
	border: 1px solid #ccc;
	background-position: center;
	background-size: cover;
	margin-bottom: 20px;
}
</style>


<sec:authorize access="isAuthenticated()">
	<sec:authentication property="principal.userVO" var="userVO" />
</sec:authorize>


<div class="container" style="background-color: white; margin-left: 1px;">
	<div class="row" style="margin-bottom: 20px; margin-left: 1px;">
		<div class="col-lg-12">
			</br>
			<h1 class="page-header">강의공지사항</h1>
		</div>
	</div>
	<div class="panel" style="margin-left: 1px;">
		<div id="contAreaBox">
			<div class="panel">
				<div class="panel-body">
					<form role="form" id="taskFrm"
						action="/professor/task/update?${_csrf.parameterName}=${_csrf.token}"
						method="post" enctype="multipart/form-data">
						<input type="hidden" name="taskCd" value="${taskVO.taskCd}" />
						<input type="hidden" name="lecCd" value="${taskVO.lecCd}" />
						<div class="table-responsive" style="text-align: center;">
							<table id="datatable-scroller"
								class="table table-bordered tbl_Form">
								<caption></caption>
								<colgroup>
									<col width="250px" />
									<col width="" />
								</colgroup>
								<tbody>
									<tr>
										<th class="active">강의명</th>
										<td class="form-inline"><input type="text" id="lecaNm"
											name="lecaNm" value="${taskVO.lectureVO.lectureApplyVO.lecaNm}" readonly
											class="form-control" style="width: 500px" />
										</td>
									</tr>
									<tr>
										<th class="active">과제명</th>
										<td class="form-inline"><input type="text" id="taskNm"
											name="taskNm" class="form-control" style="width: 500px"
											value="${taskVO.taskNm}" readonly="readonly" /></td>
									</tr>
									<tr>
										<th class="active">마감일</th>
										<td class="form-inline" id="dateTd" style="text-align: left;"><span class="form-control" id="dateSpan" style="width: 500px; display: inline-block;">
										<fmt:formatDate value="${taskVO.taskEddt}" pattern="yyyy-MM-dd" /></span>
										<input type="date" id="taskEddt" name="taskEddt" class="form-control" style="width: 500px; display: none;" />
										</td>
									</tr>
									<tr>
										<th class="active">이미지</th>
										<td class="form-inline" id="imgTd">
											<c:choose>
												<c:when test="${not empty taskVO.filesDetailVOList}">
													<c:forEach items="${taskVO.filesDetailVOList}" var="vo">
														<c:if test="${vo.fileUsed == 0}">
														<div class="image_container"
															style="background-image: url(/resources/upload/${vo.fileSvnm});"></div>
														</c:if>
													</c:forEach>
													<br />
												</c:when>
											</c:choose>
										</td>
									</tr>
									<tr>
											
											<th class="active">내용</th>
											<td class="form-inline">
											<textarea id="taskCon" name="taskCon"
												cols="100" rows="10" class="form-control"
												style="width: 500px" readonly="readonly">${taskVO.taskCon}</textarea></td>
									</tr>
								</tbody>
							</table>
						</div>

                        <div style="margin-left: 1px; position: relative;">
                            <button type="button" class="btn-two mini sky" style="right: 0; bottom: 50; z-index: 1;"
                                id="btnTaskUpdate">수정</button>
                            <button type="button" id="btnTaskSubmit" class="btn-two mini sky"
                                style="right: 0; bottom: 50; display: none; z-index: 1;">제출</button>
                            <button type="button" id="btnCancle" class="btn-two mini orange"
                                style="right: 0px; bottom: 0; z-index: 1; ">뒤로가기</button>
                            <button type="button" id="btnDelete" class="btn-two mini orange"
                                style="right: 0px; bottom: 100; z-index: 1; ">삭제</button>
                        </div>
                        <br>
                        <div>
                        </div>
						<sec:csrfInput />
					</form>
				</div>
			</div>
		</div>
	</div>
</div>
<form role="form" id="taskDeleteFrm"
action="/professor/task/delete?${_csrf.parameterName}=${_csrf.token}"
method="post">
<input type="hidden" name="taskCd" value="${taskVO.taskCd}" />
<input type="hidden" name="lecCd" value="${taskVO.lecCd}" />
</form>

<script type="text/javascript">
logout = function() {
	$("#logoutForm").submit();
}
	
$(function(){
	$("#btnTaskUpdate").on("click", function(){
		
         $("#dateSpan").hide();
         $("#taskEddt").show();
		 $("#taskNm").prop("readonly", false);
         $("#taskCon").prop("readonly", false);
         $("#taskEddt").prop("readonly", false);
         
	     $("#btnTaskUpdate").hide(); // 숨김
	     $("#btnTaskSubmit").show(); // 보여줌
	     $("#imgTd").html('<input type="file" id="uploadFiles" name="uploadFiles" class="form-control" style="width: 500px" multiple />');
	});
	$("#btnCancle").on("click", function(){
		console.log("왔다")
		
		location.href = "/professor/task/list?lecCd=" + ${taskVO.lecCd};

	});
	$("#btnDelete").on("click", function(){
		console.log("딜리트버튼")
		
		var lecCD = ${taskVO.lecCd};
		sweetConfirmDelete();
	});
	function sweetConfirmDelete() {
	    Swal.fire({
	        text: "삭제하시겠습니까?",
	        icon: "question",
	        width: 300,
	        showCancelButton: true,
	        confirmButtonColor: "#3085d6",
	        cancelButtonColor: "#d33",
	        confirmButtonText: "네",
	        cancelButtonText: "아니오"
	    }).then((result) => {
	        console.log(result);
	        if (result.isConfirmed) {
	            // "네"를 클릭했을 때의 동작
	        	$("#taskDeleteFrm").submit();
	        } else {
	            // "아니오"를 클릭했을 때의 동작
	            alertError('삭제 취소하였습니다');
	        }
	    });
	}
	
	
    $("#btnTaskSubmit").on("click", function () {
        sweetConfirmUpdate();


    });
	function sweetConfirmUpdate() {
	    Swal.fire({
	        text: "수정하시겠습니까?",
	        icon: "question",
	        width: 300,
	        showCancelButton: true,
	        confirmButtonColor: "#3085d6",
	        cancelButtonColor: "#d33",
	        confirmButtonText: "네",
	        cancelButtonText: "아니오"
	    }).then((result) => {
	        console.log(result);
	        if (result.isConfirmed) {
	            // "네"를 클릭했을 때의 동작
	            $('#taskFrm').submit();
	        } else {
	            // "아니오"를 클릭했을 때의 동작
	            alertError('수정을 취소하였습니다');
	        }
	    });
	}
	
});	

</script>




<%@ page language="java" contentType="text/html; charset=UTF-8"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"%>
<%@ taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt"%>
<%@ taglib prefix="fn" uri="http://java.sun.com/jsp/jstl/functions"%>
<%@ taglib prefix="sec"
	uri="http://www.springframework.org/security/tags"%>

<style>
.form-inline {
	width: 250px;
}

.form-inline-sec {
	width: 150px;
}

.form-inline-thr {
	width: 150px;
}

.active {
	padding-left: 10px; /* 좌측 여백 설정 */
	padding-right: 10px; /* 우측 여백 설정 */
}
</style>
<sec:authorize access="isAuthenticated()">
	<sec:authentication property="principal.userVO" var="userVO" />
</sec:authorize>

<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
<script type="text/javascript">
$(function(){
		//학생 검색
		$("#realSubmitForm").on("click",function(){
			let lecaDept = $("select[name='lecaDept']").val();
			let studentGrade = $("select[name='studentGrade']").val();
			let studentSemester = $("select[name='studentSemester']").val();
			
			let data = {
				"depCd":lecaDept,
				"stuYear":studentGrade,
				"stuSem":studentSemester
			};
			
			console.log("data : ", data);
			
			$.ajax({
				url:"/professor/getStudentListAjax",
				contentType:"application/json;charset=utf-8",
				data:JSON.stringify(data),
				type:"post",
				dataType:"json",
				beforeSend:function(xhr){
	               xhr.setRequestHeader("${_csrf.headerName}","${_csrf.token}");
	            },
				success:function(result){
					console.log("result : ", result);
				}
			});
		});
			
		//단과대 선택 시 학과가 채워짐
		$('select[name="lecaEva"]').change(
			function() {
				var selectedDepartment = $(this).val();
				
				console.log("selectedDepartment : " + selectedDepartment);
				
				let data = {
					"colCd":selectedDepartment
				};
				
				$.ajax({
					url:"/professor/getDepCdListAjax",
					contentType:"application/json;charset=utf-8",
					data:JSON.stringify(data),
					type:"post",
					dataType:"json",
					beforeSend:function(xhr){
		               xhr.setRequestHeader("${_csrf.headerName}","${_csrf.token}");
		            },
					success:function(result){
						console.log("result : ", result);
						var departmentDropdown = $('select[name="lecaDept"]');						
						departmentDropdown.empty();
						
						$('select[name="lecaDept"]').append("<option value=''>----- 선택 -----</option>");
						
						//result : List<DepartmentVO>
						//value : departmentVO
						$.each(result,
							function(index, departmentVO) {
								departmentDropdown.append($('<option>').text(departmentVO.depNm).attr('value',departmentVO.depCd));
						});//end each
					}
				});
		});//end lecaEva
});
</script>

<div class="row" style="margin-bottom: 20px; margin-left: 1px;">
	<div class="col-lg-12">
		<h1 class="page-header">장학생 추천</h1>
	</div>
</div>

<div class="panel" style="margin-left: 1px;">
	<div id="contAreaBox">
		<div class="panel">
			<div class="panel-body">
				<form name="applyFrm" role="form" id="applyFrm"
					action="/professor/lectureapply/create?${_csrf.parameterName}=${_csrf.token}"
					method="post">
					<input type="hidden" id="userCd" name="approvalVO.userCd"
						value="${userVO.userCd}" /> <input type="hidden" id="lecaTemp"
						name="lecaTemp" class="form-control" value="0" />
					<div class="table-responsive" style="text-align: center;">
						<table id="datatable-scroller"
							class="table table-bordered tbl_Form">
							<caption></caption>
							<colgroup>
							</colgroup>
							<tbody class="lectbody">
								<tr class="tr1">
									<th class="active">학생 소속 단과대</th>
									<td class="form-inline">
									<select name="lecaEva" class="form-control" style="width: 140px">
											<option value="0" selected="selected">----- 선택 -----</option>
											<option value="COLE01">경상대</option>
											<option value="COLE02">공대</option>
											<option value="COLE03">사회과학대</option>
											<option value="COLE04">예술체육대</option>
											<option value="COLE05">사범대</option>
											<option value="COLE06">인문대</option>
											<option value="COLE07">법대</option>
											<option value="COLE08">자연대</option>
									</select></td>
									<th class="active">학생 소속 학과</th>
									<td class="form-inline">
									<select name="lecaDept" class="form-control" style="width: 140px">
											<option value="0" selected="selected">----- 선택 -----</option>
									</select>
									<th class="active">학생 재학 학년</th>
									<td class="form-inline"><select name="studentGrade"
										class="form-control" style="width: 140px">
											<option value="0" selected="selected">----- 선택 -----</option>
											<option value="1">1학년</option>
											<option value="2">2학년</option>
											<option value="3">3학년</option>
											<option value="4">4학년</option>
									</select></td>
									<th class="active">학생 재학 학기</th>
									<td class="form-inline"><select name="studentSemester"
										class="form-control" style="width: 140px">
											<option value="0" selected="selected">----- 선택 -----</option>
											<option value="1">1학기</option>
											<option value="2">2학기</option>
<!-- 											<option data-semester1="0">1학기</option> -->
<!-- 											<option data-semester2="0">2학기</option> -->
									</select></td>
								</tr>
							</tbody>
						</table>
					</div>
					<div style="text-align: center;">
						<button type="button" class="btn btn-primary" id="realSubmitForm">학생 조회</button>
					</div>
					<sec:csrfInput />
				</form>
			</div>
		</div>
	</div>
</div>


<%@ page language="java" contentType="text/html; charset=UTF-8"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<%@ taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt"%>
<%@ taglib prefix="fn" uri="http://java.sun.com/jsp/jstl/functions"%>
<%@ taglib prefix="sec" uri="http://www.springframework.org/security/tags" %>
<script src="/resources/js/jquery.min.js"></script>
<script type="text/javascript" src="/resources/ckeditor/ckeditor.js"></script>
<div>
	<p>${univMailVO.umlTitle}</p>
</div>
<div>
    <p>보낸 사람</p>
    <p>${univMailVO.userVO.userNm}</p>
</div>
<div>
    <p><fmt:formatDate pattern="yyyy년 MM월 dd일 HH:mm" value="${univMailVO.umlReg}"/></p>
</div>
<div>
    <p>첨부파일</p>
    <c:forEach var="fileDetail" items="${univMailVO.filesDetailVOList}">
        <a href="/resources/upload/${fileDetail.fileSvnm}" download="${fileDetail.fileOrnm}">${fileDetail.fileOrnm}</a><br>
    </c:forEach>
</div>
<div>
	<textarea rows="5" cols="30" name="umlCon" readonly="readonly">${univMailVO.umlCon}</textarea>
</div>
<div>
	<a href="/mail/sentbox" class="btn-two gray mini">목록</a>
	<a id="deleteMail" href="/mail/sentbox" data-uml-cd="${univMailVO.umlCd}" class="btn-two red mini">삭제</a>
</div>
<sec:csrfInput />
<script>
$(function(){
	CKEDITOR.replace('umlCon');
	CKEDITOR.config.allowedContent = true;
	   
	$("#deleteMail").on("click", function(){
		if(confirm("삭제하시겠습니까?")){
			
			let umlCd = $(this).data("umlCd");
			console.log("umlCd : " + umlCd);
			
			$.ajax({
				url:"/mail/deleteSentMail?umlCd="+umlCd,
				data:umlCd,
				type:"post",
				beforeSend:function(xhr){
					xhr.setRequestHeader("${_csrf.headerName}","${_csrf.token}");
				},
				success:function(res){
					alert("삭제 완료");
					location.reload();
				}
			});
		}
	});
	
});
</script>

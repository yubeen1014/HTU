<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.or.ddit.mapper.MyPageMapper">

	<resultMap type="userVO" id="userMap">
		<result property="userCd" column="USER_CD"/>
		<result property="fileCd" column="FILE_CD"/>
		<result property="userNm" column="USER_NM"/>
		<result property="userNme" column="USER_NME"/>
		<result property="userTel" column="USER_TEL"/>
		<result property="userZip" column="USER_ZIP"/>
		<result property="userAddr1" column="USER_ADDR1"/>
		<result property="userAddr2" column="USER_ADDR2"/>
		<result property="userReg1" column="USER_REG1"/>
		<result property="userReg2" column="USER_REG2"/>
		<result property="userMail" column="USER_MAIL"/>
		<result property="userPass" column="USER_PASS"/>
		<result property="userBank" column="USER_BANK"/>
		<result property="userDepo" column="USER_DEPO"/>
		<result property="userAcc" column="USER_ACC"/>
		<result property="comdCd" column="COMD_CD"/>
		<association property="filesDetailVO" resultMap="filesDetailMap"></association>
		<association property="studentVO" resultMap="studentMap"></association>
		<association property="professorVO" resultMap="professorMap"></association>
		<association property="employeeVO" resultMap="employeeMap"></association>
	</resultMap>

	<resultMap type="filesDetailVO" id="filesDetailMap">
		<result property="fileSn" column="FILE_SN"/>
		<result property="fileCd" column="FILE_CD"/>
		<result property="filePath" column="FILE_PATH"/>
		<result property="fileOrnm" column="FILE_ORNM"/>
		<result property="fileSvnm" column="FILE_SVNM"/>
		<result property="fileExtsn" column="FILE_EXTSN"/>
		<result property="fileCon" column="FILE_CON"/>
		<result property="fileSize" column="FILE_SIZE"/>
		<result property="fileUsed" column="FILE_USED"/>
	</resultMap>	
	
	<resultMap type="studentVO" id="studentMap">
		<result property="stuCd" column="STU_CD"/>
		<result property="depCd" column="DEP_CD"/>
		<result property="comdCd" column="COMD_CD"/>
		<result property="stuYear" column="STU_YEAR"/>
		<result property="stuSem" column="STU_SEM"/>
		<result property="stuMrc" column="STU_MRC"/>
		<result property="stuMoc" column="STU_MOC"/>
		<result property="stuCrc" column="STU_CRC"/>
		<result property="stuCoc" column="STU_COC"/>
		<result property="stuAddt" column="STU_ADDT"/>
		<result property="stuGrdt" column="STU_GRDT"/>
	</resultMap>
	
	<resultMap type="professorVO" id="professorMap">
		<result property="proCd" column="PRO_CD"/>
		<result property="depCd" column="DEP_CD"/>
		<result property="roomCd" column="ROOM_CD"/>
		<result property="proJoin" column="PRO_JOIN"/>
		<result property="proRet" column="PRO_RET"/>
		<result property="proPos" column="PRO_POS"/>
	</resultMap>
	
	<resultMap type="employeeVO" id="employeeMap">
		<result property="empCd" column="EMP_CD"/>
		<result property="empDept" column="EMP_DEPT"/>
		<result property="empPos" column="EMP_POS"/>
		<result property="empJoin" column="EMP_JOIN"/>
		<result property="empQuit" column="EMP_QUIT"/>	
	</resultMap>
	
	<select id="profile" parameterType="String" resultMap="userMap">
		SELECT U.USER_CD,
		       U.FILE_CD,
		       U.USER_NM,
		       U.USER_NME,
		       U.USER_TEL,
		       U.USER_ZIP,
		       U.USER_ADDR1,
		       U.USER_ADDR2,
		       U.USER_REG1,
		       U.USER_REG2,
		       U.USER_MAIL,
		       U.USER_PASS,
		       U.USER_BANK,
		       U.USER_DEPO,
		       U.USER_ACC,
		       U.COMD_CD,
		       F.FILE_SN,
		       F.FILE_CD AS F_FILE_CD,
		       F.FILE_PATH,
		       F.FILE_ORNM,
		       F.FILE_SVNM,
		       F.FILE_EXTSN,
		       F.FILE_CON,
		       F.FILE_SIZE,
		       F.FILE_USED,
		       S.STU_CD AS S_STU_CD,
		       S.DEP_CD AS S_DEP_CD,
		       S.COMD_CD AS S_COMD_CD,
		       S.STU_YEAR,
		       S.STU_SEM,
		       S.STU_MRC,
		       S.STU_MOC,
		       S.STU_CRC,
		       S.STU_COC,
		       S.STU_ADDT,
		       S.STU_GRDT,
		       P.PRO_CD,
		       P.DEP_CD AS P_DEP_CD,
		       P.ROOM_CD,
		       P.PRO_JOIN,
		       P.PRO_RET,
		       P.PRO_POS,
		       E.EMP_CD, E.EMP_DEPT, E.EMP_POS, E.EMP_JOIN, E.EMP_QUIT
		FROM USERS U
		LEFT OUTER JOIN FILES_DETAIL F ON U.USER_CD = F.FILE_CD AND F.FILE_USED = 0
		LEFT OUTER JOIN STUDENT S ON U.USER_CD = S.STU_CD
		LEFT OUTER JOIN PROFESSOR P ON U.USER_CD = P.PRO_CD
		LEFT OUTER JOIN EMPLOYEE E ON U.USER_CD = E.EMP_CD
         			WHERE U.USER_CD=#{userCd}
	</select>
	
	<select id="profileEdit" parameterType="String" resultType="userVO">
		SELECT USER_CD, FILE_CD, USER_NM, USER_NME, USER_TEL, USER_ZIP, USER_ADDR1, USER_ADDR2, USER_REG1, USER_REG2, USER_MAIL, USER_PASS, USER_BANK, USER_DEPO, USER_ACC, COMD_CD
		FROM   USERS
		WHERE  USER_CD = #{userCd}
	</select>
	
	<update id="profileEditPost" parameterType="userVO">
		UPDATE USERS
		SET USER_TEL = #{userTel}, 
			USER_ADDR1 = #{userAddr1}, 
			USER_ADDR2 = #{userAddr2}, 
			USER_MAIL = #{userMail},
			USER_BANK = #{userBank},
			USER_ACC = #{userAcc}
		WHERE USER_CD = #{userCd}
	</update>
	
	<update id="passEditPost" parameterType="userVO">
		UPDATE USERS
		SET USER_PASS = #{userPass}
		WHERE USER_CD = #{userCd}
	</update>
	
	<select id="getEncodedPassword" parameterType="String" resultMap="userMap">
		SELECT USER_PASS FROM USERS WHERE USER_CD = #{userCd}
	</select>
</mapper>